import static com.github.stefanbirkner.systemlambda.SystemLambda.catchSystemExit;
import static org.junit.jupiter.api.Assertions.assertEquals;

import com.bnpparibas.atlentic.irep.ecb.main.P06_IREP_01_Main;
import com.bnpparibas.atlentic.irep.ecb.util.exception.P06_IREP_01_ExitApplicationException;
import org.junit.jupiter.api.Test;
import org.mockito.MockedStatic;

import java.lang.reflect.Constructor;
import java.lang.reflect.Method;

import static org.mockito.Mockito.*;

class P06_IREP_01_MainExitTest {

    @Test
    void testSystemExitOnExitApplicationException() throws Exception {
        String[] args = { "level1", "BR", "01/01/2024 10:00:00" };
        Constructor<P06_IREP_01_Main> ctor = P06_IREP_01_Main.class.getDeclaredConstructor(String[].class);
        ctor.setAccessible(true);
        Object mainInstance = ctor.newInstance((Object) args);

        Method executeMethod = P06_IREP_01_Main.class.getDeclaredMethod("execute");
        executeMethod.setAccessible(true);

        try (
            MockedStatic<com.bnpparibas.atlentic.irep.ecb.resource.P06_IREP_01_PropertiesMgr> propsMgr = mockStatic(com.bnpparibas.atlentic.irep.ecb.resource.P06_IREP_01_PropertiesMgr.class);
            MockedStatic<com.bnpparibas.atlentic.common.gen.string.utilities.StringConverter> stringConverter = mockStatic(com.bnpparibas.atlentic.common.gen.string.utilities.StringConverter.class);
            MockedStatic<com.bnpparibas.atlentic.irep.ecb.level1.P06_IREP_01_Level1> level1Mock = mockStatic(com.bnpparibas.atlentic.irep.ecb.level1.P06_IREP_01_Level1.class)
        ) {
            propsMgr.when(() -> com.bnpparibas.atlentic.irep.ecb.resource.P06_IREP_01_PropertiesMgr.getLevellActionName())
                    .thenReturn("level1");
            stringConverter.when(() -> com.bnpparibas.atlentic.common.gen.string.utilities.StringConverter.StringToDate("01/01/2024 10:00:00"))
                    .thenReturn(new java.util.Date());

            // Simulate Level1().execute() throwing ExitApplicationException
            level1Mock.when(() -> new com.bnpparibas.atlentic.irep.ecb.level1.P06_IREP_01_Level1())
                    .thenThrow(new P06_IREP_01_ExitApplicationException("exit"));

            int statusCode = catchSystemExit(() -> {
                executeMethod.invoke(mainInstance);
            });

            assertEquals(8, statusCode);
        }
    }
}

