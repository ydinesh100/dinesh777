package com.bnpparibas.atlentic.irep.ecb.main.test;

import static com.github.stefanbirkner.systemlambda.SystemLambda.catchSystemExit;
import static org.junit.jupiter.api.Assertions.assertEquals;

import java.lang.reflect.Constructor;
import java.lang.reflect.Method;

import org.junit.jupiter.api.Test;

public class P06_IREP_01_MainSystemExitTest {

    @Test
    void testSystemExitOnExitApplicationException() throws Exception {
        int statusCode = catchSystemExit(() -> {
            // Prepare args that cause ExitApplicationException to be thrown
            String[] args = { "invalidAction" };

            Constructor<?> constructor = Class.forName("com.bnpparibas.atlentic.irep.ecb.main.P06_IREP_01_Main")
                .getDeclaredConstructor(String[].class);
            constructor.setAccessible(true);
            Object mainInstance = constructor.newInstance((Object) args);

            // Access and invoke the private execute() method
            Method executeMethod = mainInstance.getClass().getDeclaredMethod("execute");
            executeMethod.setAccessible(true);

            // You must throw ExitApplicationException in your mock or stub for this to hit the System.exit(8)
            executeMethod.invoke(mainInstance); // This should cause System.exit(8)
        });

        assertEquals(8, statusCode);
    }
}
