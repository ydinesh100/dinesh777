package com.bnpparibas.atlentic.irep.ecb.main.test;

import static com.github.stefanbirkner.systemlambda.SystemLambda.catchSystemExit;
import static org.junit.jupiter.api.Assertions.assertEquals;

import java.lang.reflect.Constructor;
import java.lang.reflect.Method;

import org.junit.jupiter.api.Test;

public class P06_IREP_01_MainTest {

    @Test
    void testSystemExitWhenExitApplicationExceptionThrown() throws Exception {
        int statusCode = catchSystemExit(() -> {
            // Simulate args that cause ExitApplicationException â†’ System.exit(8)
            String[] args = {}; // or invalid args like {"invalid"}

            Constructor<?> constructor = Class.forName("com.bnpparibas.atlentic.irep.ecb.main.P06_IREP_01_Main")
                    .getDeclaredConstructor(String[].class);
            constructor.setAccessible(true);
            Object mainInstance = constructor.newInstance((Object) args);

            Method executeMethod = mainInstance.getClass().getDeclaredMethod("execute");
            executeMethod.setAccessible(true);
            try {
                executeMethod.invoke(mainInstance);
            } catch (Exception e) {
                // ignore or log if needed
            }
        });

        assertEquals(8, statusCode);
    }
}
